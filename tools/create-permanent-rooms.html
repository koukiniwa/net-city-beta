<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›ºå®šãƒ«ãƒ¼ãƒ ä½œæˆãƒ„ãƒ¼ãƒ«</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2196f3;
            text-align: center;
        }
        button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
        }
        button:hover {
            background: #1976d2;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        #log {
            margin-top: 20px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 5px;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .log-item {
            margin: 5px 0;
        }
        .success {
            color: green;
        }
        .error {
            color: red;
        }
        .info {
            color: #2196f3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>å›ºå®šãƒ«ãƒ¼ãƒ ä½œæˆãƒ„ãƒ¼ãƒ«</h1>
        <p>ã“ã®ãƒ„ãƒ¼ãƒ«ã¯ã€NET CITY Î²ã«å›ºå®šãƒ«ãƒ¼ãƒ ã‚’ä½œæˆã—ã¾ã™ã€‚</p>
        <button id="createBtn">å›ºå®šãƒ«ãƒ¼ãƒ ã‚’ä½œæˆã™ã‚‹</button>
        <div id="log"></div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
        import { getDatabase, ref, set, get } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js';

        // Firebaseã®è¨­å®š
        const firebaseConfig = {
            apiKey: "AIzaSyBv2rtsWPL8AHqnlXlRKfMkXptAvV7QBWM",
            authDomain: "net-city-beta.firebaseapp.com",
            databaseURL: "https://net-city-beta-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "net-city-beta",
            storageBucket: "net-city-beta.firebasestorage.app",
            messagingSenderId: "134573205357",
            appId: "1:134573205357:web:59080845633bf5e39b9c64"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        const logDiv = document.getElementById('log');
        const createBtn = document.getElementById('createBtn');

        function addLog(message, type = 'info') {
            const logItem = document.createElement('div');
            logItem.className = `log-item ${type}`;
            logItem.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(logItem);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // å›ºå®šãƒ«ãƒ¼ãƒ ã®å®šç¾©
        const permanentRooms = [
            // é›‘è«‡ã‚«ãƒ†ã‚´ãƒª
            {
                id: 'plaza',
                name: 'åºƒå ´',
                emoji: 'ğŸ ',
                category: 'chat',
                description: 'ã¿ã‚“ãªã§è‡ªç”±ã«é›‘è«‡ã—ã‚ˆã†',
                maxUsers: 50
            },
            {
                id: 'night_talk',
                name: 'å¤œã®ã²ã¨ã‚Šã”ã¨',
                emoji: 'ğŸŒ™',
                category: 'chat',
                description: 'å¤œæ›´ã‹ã—ã•ã‚“é›†ã¾ã‚Œ',
                maxUsers: 50
            },
            // ç›¸è«‡ã‚«ãƒ†ã‚´ãƒª
            {
                id: 'consultation_room',
                name: 'å¿ƒã®ç›¸è«‡å®¤',
                emoji: 'ğŸ’­',
                category: 'consultation',
                description: 'æ‚©ã¿ã‚’ç›¸è«‡ã§ãã‚‹å ´æ‰€',
                maxUsers: 50
            },
            {
                id: 'complaint_room',
                name: 'æ„šç—´èãã¾ã™',
                emoji: 'ğŸ˜¤',
                category: 'consultation',
                description: 'æ„šç—´ã‚’åãå‡ºã—ã¦ã‚¹ãƒƒã‚­ãƒª',
                maxUsers: 50
            },
            // æ‹æ„›ã‚«ãƒ†ã‚´ãƒª
            {
                id: 'love_talk',
                name: 'æ‹ãƒãƒŠãƒ«ãƒ¼ãƒ ',
                emoji: 'ğŸ’•',
                category: 'love',
                description: 'æ‹æ„›ãƒˆãƒ¼ã‚¯ã§ç››ã‚Šä¸ŠãŒã‚ã†',
                maxUsers: 50
            },
            {
                id: 'heartbreak_cafe',
                name: 'å¤±æ‹ã‚«ãƒ•ã‚§',
                emoji: 'ğŸ’”',
                category: 'love',
                description: 'å¤±æ‹ã®å‚·ã‚’ç™’ã™å ´æ‰€',
                maxUsers: 50
            },
            // æ™‚äº‹ã‚«ãƒ†ã‚´ãƒª
            {
                id: 'current_topics',
                name: 'ä»Šã®è©±é¡Œ',
                emoji: 'ğŸ“°',
                category: 'news',
                description: 'æœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹ã«ã¤ã„ã¦èªã‚ã†',
                maxUsers: 50
            },
            // äººç”Ÿã‚«ãƒ†ã‚´ãƒª
            {
                id: 'music_anime',
                name: 'éŸ³æ¥½/ã‚¢ãƒ‹ãƒ¡',
                emoji: 'ğŸµ',
                category: 'life',
                description: 'éŸ³æ¥½ã‚„ã‚¢ãƒ‹ãƒ¡ã«ã¤ã„ã¦èªã‚ã†',
                maxUsers: 50
            },
            {
                id: 'game_talk',
                name: 'ã‚²ãƒ¼ãƒ ãƒˆãƒ¼ã‚¯',
                emoji: 'ğŸ®',
                category: 'life',
                description: 'ã‚²ãƒ¼ãƒ å¥½ãé›†ã¾ã‚Œï¼',
                maxUsers: 50
            }
        ];

        async function createPermanentRooms() {
            createBtn.disabled = true;
            addLog('å›ºå®šãƒ«ãƒ¼ãƒ ã®ä½œæˆã‚’é–‹å§‹ã—ã¾ã™...', 'info');

            try {
                for (const room of permanentRooms) {
                    const roomRef = ref(database, `rooms/${room.id}`);

                    // æ—¢ã«å­˜åœ¨ã™ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                    const snapshot = await get(roomRef);

                    if (snapshot.exists()) {
                        addLog(`${room.name} ã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™ï¼ˆã‚¹ã‚­ãƒƒãƒ—ï¼‰`, 'info');
                        continue;
                    }

                    // ãƒ«ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ
                    const roomData = {
                        id: room.id,
                        name: room.name,
                        emoji: room.emoji,
                        category: room.category,
                        description: room.description,
                        maxUsers: room.maxUsers,
                        currentUsers: 0,
                        isPermanent: true,
                        createdAt: Date.now(),
                        createdBy: 'system'
                    };

                    // Firebaseã«ä¿å­˜
                    await set(roomRef, roomData);
                    addLog(`âœ“ ${room.name} ã‚’ä½œæˆã—ã¾ã—ãŸï¼ˆã‚«ãƒ†ã‚´ãƒª: ${room.category}ï¼‰`, 'success');
                }

                addLog('===== å…¨ã¦ã®å›ºå®šãƒ«ãƒ¼ãƒ ã®ä½œæˆãŒå®Œäº†ã—ã¾ã—ãŸï¼ =====', 'success');

            } catch (error) {
                addLog(`ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}`, 'error');
                console.error(error);
            } finally {
                createBtn.disabled = false;
            }
        }

        createBtn.addEventListener('click', createPermanentRooms);

        addLog('æº–å‚™å®Œäº†ã€‚ã€Œå›ºå®šãƒ«ãƒ¼ãƒ ã‚’ä½œæˆã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚', 'info');
    </script>
</body>
</html>
