<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- SEO対策: 基本のmetaタグ -->
    <title>NET CITY β - チャット中 | リアルタイムチャット</title>
    <meta name="description" content="NET CITY βのチャットルーム。未来的な街の背景で、リアルタイムにメッセージをやりとりしよう。">
    <meta name="keywords" content="チャット,リアルタイム,オンライン,NET CITY,ネットシティ">
    <meta name="author" content="koukiniwa">

    <!-- OGP（Open Graph Protocol）- SNSでシェアした時の表示 -->
    <meta property="og:title" content="NET CITY β - チャット中">
    <meta property="og:description" content="未来的な街の背景で、リアルタイムにチャットを楽しもう！">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://koukiniwa.github.io/net-city-beta/city.html">
    <meta property="og:image" content="https://koukiniwa.github.io/net-city-beta/ogp-image.svg">
    <meta property="og:site_name" content="NET CITY β">
    <meta property="og:locale" content="ja_JP">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="NET CITY β - チャット中">
    <meta name="twitter:description" content="未来的な街の背景で、リアルタイムにチャットを楽しもう！">
    <meta name="twitter:image" content="https://koukiniwa.github.io/net-city-beta/ogp-image.svg">

    <!-- 検索エンジン向け -->
    <meta name="robots" content="index, follow">

    <!-- PWA対応 -->
    <meta name="theme-color" content="#00ffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="NET CITY">
    <link rel="manifest" href="manifest.json">

    <!-- ファビコン設定（複数サイズ） -->
    <link rel="icon" type="image/svg+xml" href="icon.svg">
    <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.webp">
    <link rel="icon" type="image/png" sizes="512x512" href="icons/icon-512.webp">
    <link rel="apple-touch-icon" sizes="192x192" href="icons/icon-192.webp">
    <link rel="apple-touch-icon" sizes="512x512" href="icons/icon-512.webp">

    <!-- スタイルシートを読み込み -->
    <link rel="stylesheet" href="css/city.css">
</head>
<body>
    <!-- 街の背景 -->
    <div class="city-background">
        <!-- 未来的な街のグラデーション背景 -->
        <div class="sky-gradient"></div>

        <!-- 建物のシルエット（CSS で描画） -->
        <div class="city-skyline">
            <div class="building" style="left: 5%; width: 60px; height: 200px;"></div>
            <div class="building" style="left: 12%; width: 80px; height: 280px;"></div>
            <div class="building" style="left: 20%; width: 50px; height: 180px;"></div>
            <div class="building" style="left: 28%; width: 90px; height: 320px;"></div>
            <div class="building" style="left: 38%; width: 70px; height: 240px;"></div>
            <div class="building" style="left: 48%; width: 55px; height: 200px;"></div>
            <div class="building" style="left: 56%; width: 85px; height: 300px;"></div>
            <div class="building" style="left: 66%; width: 65px; height: 220px;"></div>
            <div class="building" style="left: 74%; width: 75px; height: 260px;"></div>
            <div class="building" style="left: 84%; width: 60px; height: 190px;"></div>
            <div class="building" style="left: 92%; width: 70px; height: 240px;"></div>
        </div>
    </div>

    <!-- ヘッダー（上部のバー） -->
    <header class="header">
        <div class="header-left">
            <h1 class="city-title">NET CITY β</h1>
        </div>
        <div class="header-right">
            <span class="username-display" id="usernameDisplay">ゲスト</span>
            <button class="edit-name-button" id="editNameButton" title="名前を変更">✏️</button>
        </div>
    </header>

    <!-- チャットエリア -->
    <div class="chat-container">
        <!-- ルーム選択バー -->
        <div class="room-bar" id="roomBar">
            <div class="room-tabs" id="roomTabs">
                <!-- ルームタブがここに動的に追加される -->
            </div>
            <button class="create-room-btn" id="createRoomBtn" title="新しいルームを作成">
                ➕
            </button>
        </div>

        <!-- チャットヘッダー -->
        <div class="chat-header">
            <div class="online-indicator"></div>
            <span id="currentRoomName">街のチャット</span>
            <span class="online-count" id="onlineCount">接続中...</span>
        </div>

        <!-- メッセージ表示エリア -->
        <div class="messages-area" id="messagesArea">
            <!-- ここにメッセージが表示される -->
            <div class="welcome-message">
                <p>NET CITY βへようこそ！</p>
                <p>みんなとチャットを楽しもう</p>
            </div>
        </div>

        <!-- メッセージ入力エリア -->
        <div class="input-area">
            <input type="file" id="imageInput" accept="image/*" style="display: none;">
            <button id="imageButton" class="image-button" title="画像を送信">
                📷
            </button>
            <textarea
                id="messageInput"
                class="message-input"
                placeholder="メッセージを入力..."
                maxlength="200"
                autocomplete="off"
                rows="1"
            ></textarea>
            <button id="sendButton" class="send-button">
                <span>送信</span>
            </button>
        </div>
    </div>

    <!-- Firebase SDKを読み込み（CDN版） -->
    <!-- Firebase 9.x系（モジュール版） -->
    <script type="module">
        // Firebase SDK（バージョン9以降）をインポート
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
        import { getDatabase } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js';
        import { getStorage } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-storage.js';

        // Firebaseの設定
        const firebaseConfig = {
            apiKey: "AIzaSyBv2rtsWPL8AHqnlXlRKfMkXptAvV7QBWM",
            authDomain: "net-city-beta.firebaseapp.com",
            databaseURL: "https://net-city-beta-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "net-city-beta",
            storageBucket: "net-city-beta.firebasestorage.app",
            messagingSenderId: "134573205357",
            appId: "1:134573205357:web:59080845633bf5e39b9c64"
        };

        // Firebaseを初期化
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const storage = getStorage(app);

        // グローバルに公開（city.jsで使う）
        window.firebaseApp = app;
        window.firebaseDatabase = database;
        window.firebaseStorage = storage;
    </script>

    <!-- メッセージ編集モーダル -->
    <div class="edit-message-modal" id="editMessageModal">
        <div class="edit-message-content">
            <h2 class="edit-message-title">メッセージを編集</h2>
            <textarea id="editMessageTextarea" class="edit-message-textarea" maxlength="200"></textarea>
            <div class="edit-message-actions">
                <button class="btn-cancel-edit" id="cancelEditMessage">キャンセル</button>
                <button class="btn-save-edit" id="saveEditMessage">保存</button>
            </div>
        </div>
    </div>

    <!-- ルーム作成モーダル -->
    <div class="modal" id="createRoomModal">
        <div class="modal-content">
            <h2 class="modal-title">新しいルームを作成</h2>
            <div class="form-group">
                <label for="roomName">ルーム名</label>
                <input type="text" id="roomName" maxlength="15" placeholder="例：深夜の雑談" autocomplete="off">
            </div>
            <div class="form-group">
                <label>絵文字アイコン</label>
                <div class="emoji-selector" id="emojiSelector">
                    <button class="emoji-option" data-emoji="💬">💬</button>
                    <button class="emoji-option" data-emoji="🎮">🎮</button>
                    <button class="emoji-option" data-emoji="🎵">🎵</button>
                    <button class="emoji-option" data-emoji="📚">📚</button>
                    <button class="emoji-option" data-emoji="🎨">🎨</button>
                    <button class="emoji-option" data-emoji="⚽">⚽</button>
                    <button class="emoji-option" data-emoji="🍕">🍕</button>
                    <button class="emoji-option" data-emoji="☕">☕</button>
                    <button class="emoji-option" data-emoji="🌙">🌙</button>
                    <button class="emoji-option" data-emoji="⭐">⭐</button>
                </div>
            </div>
            <div class="form-group">
                <label>最大人数</label>
                <div class="max-users-selector">
                    <label><input type="radio" name="maxUsers" value="10"> 10人</label>
                    <label><input type="radio" name="maxUsers" value="20"> 20人</label>
                    <label><input type="radio" name="maxUsers" value="30" checked> 30人</label>
                    <label><input type="radio" name="maxUsers" value="50"> 50人</label>
                </div>
            </div>
            <div class="form-group">
                <label for="roomDescription">説明（任意）</label>
                <input type="text" id="roomDescription" maxlength="50" placeholder="このルームについて..." autocomplete="off">
            </div>
            <div class="modal-actions">
                <button class="btn-cancel" id="cancelCreateRoom">キャンセル</button>
                <button class="btn-create" id="confirmCreateRoom">作成する</button>
            </div>
        </div>
    </div>

    <!-- チャット機能のJavaScriptを読み込み -->
    <script type="module" src="js/city.js"></script>

    <!-- Service Worker 登録 -->
    <script>
        // Service Worker がサポートされているかチェック
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then((registration) => {
                        console.log('✅ Service Worker 登録成功:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('❌ Service Worker 登録失敗:', error);
                    });
            });
        }
    </script>
</body>
</html>
